<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Daily Orbit - Login / Signup</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&family=Roboto:wght@400;700&display=swap');

html, body {
    margin: 0;
    height: 100%;
    font-family: 'Roboto', sans-serif;
    color: #242035;
    overflow: hidden;
    background: linear-gradient(135deg, #f0eded 0%, #e8e0f0 45%, #e5ecf5 100%);
    display: flex;
    justify-content: center;
    align-items: center;
}

.wrapper {
    border-radius: 20px;
    background: rgba(255, 255, 255, 0.85);
    backdrop-filter: blur(6px);
    border: 1px solid rgba(107, 70, 193, 0.15);
    box-shadow: 0 6px 18px rgba(38, 30, 60, 0.10);
    max-width: 1000px;
    width: 90%;
    display: flex;
    padding: 50px 60px;
    box-sizing: border-box;
    gap: 40px;
}

.welcome-section {
    flex: 1;
    display: flex;
    flex-direction: column;
    justify-content: center;
    text-align: left;
}

.brand-row {
  display: flex;
  align-items: center;
  gap: 15px;
  margin-bottom: 20px;
}

.logo {
  width: 64px;
  height: 64px;
  border-radius: 50%;
  object-fit: cover;
  border: 1px solid rgba(34,32,52,0.1);
}

.website-name {
  font-family: 'Playfair Display', serif;
  font-size: 3rem;
  font-weight: 700;
  letter-spacing: 0.05em;
}

.welcome-title {
    font-family: 'Playfair Display', serif;
    font-size: 2.2rem;
    font-weight: 600;
    margin-bottom: 15px;
    background: linear-gradient(90deg, #6b46ff, #b892ff);
    -webkit-background-clip: text;
    background-clip: text;
    -webkit-text-fill-color: transparent;
}

.welcome-description {
    font-size: 1.2rem;
    line-height: 1.6;
    color: rgba(34, 32, 52, 0.8);
}

.auth-container {
    flex: 1;
    display: flex;
    flex-direction: column;
    justify-content: center;
    background: rgba(255, 255, 255, 0.9);
    border-radius: 15px;
    padding: 40px 30px;
    border: 1px solid rgba(107, 70, 193, 0.15);
    text-align: center;
}

.auth-title {
    font-family: 'Playfair Display', serif;
    font-size: 2rem;
    margin-bottom: 20px;
    color: #6b46ff;
}

form {
    display: flex;
    flex-direction: column;
    text-align: left;
}

label {
    font-weight: 600;
    margin-bottom: 8px;
    font-size: 0.95rem;
}

input {
    width: 100%;
    padding: 12px;
    margin-bottom: 15px;
    border-radius: 8px;
    border: 1px solid #ccc;
    font-size: 1rem;
    box-sizing: border-box;
}

button[type="submit"] {
    width: 100%;
    padding: 12px;
    background: linear-gradient(135deg, #6b46ff, #b892ff);
    border: none;
    border-radius: 10px;
    color: #fff;
    font-weight: 700;
    font-size: 1.1rem;
    cursor: pointer;
    margin-top: 10px;
    transition: transform 0.2s;
}

button[type="submit"]:hover {
    transform: translateY(-2px);
}

.toggle-auth {
    margin-top: 20px;
    font-size: 0.9rem;
}

.toggle-auth a {
    color: #6b46ff;
    font-weight: 700;
    cursor: pointer;
    text-decoration: underline;
}

#signup-form { display: none; }
.error-msg { color: #e74c3c; font-size: 0.9rem; margin-bottom: 10px; display: none; }

/* Mobile */
@media (max-width: 768px) {
    .wrapper { flex-direction: column; padding: 30px 20px; }
    .welcome-section { text-align: center; margin-bottom: 30px; }
    .brand-row { justify-content: center; }
}
</style>

<script src="assets/js/api.js"></script>

</head>
<body>

<div class="wrapper">
  <div class="welcome-section">
    <div class="brand-row">
      <img src="assets/logo.png" alt="Logo" class="logo" onerror="this.style.display='none'"> 
      <div class="website-name">DAILY ORBIT</div>
    </div>
    <div class="welcome-title">Your daily planner</div>
    <div class="welcome-description">
      Plan tasks, track moods, and build better routines with our emotion-based scheduler.
    </div>
  </div>

  <div class="auth-container">
    
    <div id="login-form">
      <div class="auth-title">Log In</div>
      <div class="error-msg" id="login-error"></div>
      <form id="login">
        <label>Email Address</label>
        <input type="email" id="login-email" placeholder="you@example.com" required>
        <label>Password</label>
        <input type="password" id="login-password" required>
        <button type="submit">Log In</button>
      </form>
      <div class="toggle-auth">Don't have an account? <a onclick="toggleForms()">Sign Up</a></div>
    </div>

    <div id="signup-form">
      <div class="auth-title">Create Account</div>
      <div class="error-msg" id="signup-error"></div>
      <form id="signup">
        <label>Full Name</label>
        <input type="text" id="signup-name" placeholder="John Doe" required>
        <label>Email Address</label>
        <input type="email" id="signup-email" placeholder="you@example.com" required>
        <label>Password</label>
        <input type="password" id="signup-password" required>
        <button type="submit">Sign Up</button>
      </form>
      <div class="toggle-auth">Already have an account? <a onclick="toggleForms()">Log In</a></div>
    </div>

  </div>
</div>

<script>
// Toggle between Login and Signup views
function toggleForms() {
  const loginForm = document.getElementById('login-form');
  const signupForm = document.getElementById('signup-form');
  const errLogin = document.getElementById('login-error');
  const errSignup = document.getElementById('signup-error');
  
  // Clear errors when switching
  if(errLogin) errLogin.style.display = 'none';
  if(errSignup) errSignup.style.display = 'none';

  if (loginForm.style.display === 'none') {
    loginForm.style.display = 'block';
    signupForm.style.display = 'none';
  } else {
    loginForm.style.display = 'none';
    signupForm.style.display = 'block';
  }
}

// Handle Login
document.getElementById('login').addEventListener('submit', async function(e){
  e.preventDefault();
  const email = document.getElementById('login-email').value;
  const password = document.getElementById('login-password').value;
  const errBox = document.getElementById('login-error');

  // Submit UI State
  const btn = e.target.querySelector('button');
  const originalText = btn.textContent;
  btn.textContent = "Logging in...";
  btn.disabled = true;

  try {
    // ðŸŸ¢ 2. USE AUTH FETCH (Points to Render automatically)
    const res = await authFetch('/api/auth/login', {
      method: 'POST',
      body: JSON.stringify({ email, password })
    });
    
    if (!res) throw new Error("Connection failed"); // authFetch handles timeouts but returns null on some errors

    const data = await res.json();

    if (res.ok) {
      // SUCCESS
      localStorage.setItem('user_token', data.token);
      localStorage.setItem('user_name', data.name);
      localStorage.setItem('user_email', data.email);
      window.location.href = 'dashboard.html';
    } else {
      // ERROR
      errBox.textContent = data.message || 'Login failed';
      errBox.style.display = 'block';
    }
  } catch (error) {
    console.error(error);
    errBox.textContent = 'Server not responding. It might be waking up (wait 30s).';
    errBox.style.display = 'block';
  } finally {
    btn.textContent = originalText;
    btn.disabled = false;
  }
});

// Handle Signup
document.getElementById('signup').addEventListener('submit', async function(e){
  e.preventDefault();
  const name = document.getElementById('signup-name').value;
  const email = document.getElementById('signup-email').value;
  const password = document.getElementById('signup-password').value;
  const errBox = document.getElementById('signup-error');

  const btn = e.target.querySelector('button');
  const originalText = btn.textContent;
  btn.textContent = "Creating...";
  btn.disabled = true;

  try {
    // ðŸŸ¢ 3. USE AUTH FETCH HERE TOO
    const res = await authFetch('/api/auth/register', {
      method: 'POST',
      body: JSON.stringify({ name, email, password })
    });
    
    if (!res) throw new Error("Connection failed");

    const data = await res.json();

    if (res.ok) {
      localStorage.setItem('user_token', data.token);
      localStorage.setItem('user_name', data.name);
      localStorage.setItem('user_email', data.email);
      window.location.href = 'dashboard.html';
    } else {
      errBox.textContent = data.message || 'Signup failed';
      errBox.style.display = 'block';
    }
  } catch (error) {
    console.error(error);
    errBox.textContent = 'Server not responding.';
    errBox.style.display = 'block';
  } finally {
    btn.textContent = originalText;
    btn.disabled = false;
  }
});
</script>

</body>
</html>